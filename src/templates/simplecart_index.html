<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
<link rel="stylesheet" href="<{$simplecart_module_url}>assets/css/simplecart.css">
<style>[x-cloak] { display: none !important; }</style>

<section class="section" x-data>
  <div class="container">
    <h1 class="title is-4"><{$smarty.const._MD_SIMPLECART_SHOP_TITLE}></h1>

    <!-- Products: Server-rendered with Alpine.js for add-to-cart -->
    <div class="columns is-multiline">
      <{foreach from=$products item=product}>
      <div class="column is-12-mobile is-6-tablet is-4-desktop">
        <div class="card">
          <div class="card-content">
            <p class="title is-5"><{$product.name}></p>
            <p class="subtitle is-6 sc-card-price"><{$product.price_formatted}></p>
            <div class="buttons">
              <button class="button is-primary is-small"
                @click="$store.cart.add({id: <{$product.id}>, name: '<{$product.name|escape:'javascript'}>', price: <{$product.price}>})">
                <{$smarty.const._MD_SIMPLECART_ADD_TO_CART}>
              </button>
            </div>
          </div>
        </div>
      </div>
      <{/foreach}>
    </div>

    <!-- Cart: Client-side rendered by Alpine.js -->
    <div class="box" x-show="$store.cart.items.length > 0" x-cloak>
      <h2 class="title is-5"><{$smarty.const._MD_SIMPLECART_YOUR_CART}></h2>
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th><{$smarty.const._MD_SIMPLECART_NAME}></th>
            <th class="has-text-centered">Qty</th>
            <th class="has-text-right"><{$smarty.const._MD_SIMPLECART_TOTAL}></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <template x-for="item in $store.cart.items" :key="item.product_id">
            <tr>
              <td>
                <span x-text="item.name"></span>
                <span class="tag is-light" x-text="currency(item.price)"></span>
              </td>
              <td class="has-text-centered">
                <div class="buttons has-addons is-centered">
                  <button class="button is-small" @click="$store.cart.dec(item)">-</button>
                  <span class="button is-static is-small" x-text="item.quantity"></span>
                  <button class="button is-small" @click="$store.cart.inc(item)">+</button>
                </div>
              </td>
              <td class="has-text-right" x-text="currency(item.price * item.quantity)"></td>
              <td class="has-text-right">
                <a href="#" class="button is-text is-small" @click.prevent="$store.cart.remove(item)">
                  <{$smarty.const._MD_SIMPLECART_REMOVE}>
                </a>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
      <div class="has-text-right is-size-5 has-text-weight-semibold sc-total">
        <{$smarty.const._MD_SIMPLECART_TOTAL}>: <span x-text="currency($store.cart.total)"></span>
      </div>
      <a href="<{$simplecart_module_url}>checkout.php" class="button is-link is-pulled-right">
        <{$smarty.const._MD_SIMPLECART_CHECKOUT}>
      </a>
      <div class="is-clearfix"></div>
    </div>

    <!-- Empty cart message -->
    <div x-show="$store.cart.items.length === 0" class="notification is-light">
      <{$smarty.const._MD_SIMPLECART_EMPTY_CART}>
    </div>
  </div>
</section>

<!-- Load cart.js first to register Alpine store, then Alpine.js -->
<script src="<{$simplecart_module_url}>assets/js/cart.js?v=2"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
